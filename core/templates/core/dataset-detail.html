{% extends 'base.html' %}
{% load cache %}
{% load humanize %}
{% load l10n %}
{% load static %}
{% load markdown %}
{% load utils %}
{% block title %}{{ dataset.name }} - Datasets - Brasil.IO{% endblock %}

{% block head %}
{{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'core/css/dataset-detail.css' %}"/>
{% endblock %}

{% block nav %}
<div class="nav-content indigo">
  <div class="breadcrumb">
    <a href="{% url 'core:dataset-list' %}" title="Voltar para Dataset">Datasets</a> > {{ dataset.name }}
  </div>
</div>
{% endblock %}
{% block content %}{% localize off %}
<div class="section">
  <div class="row">
    <div class="col s12 m7">
      <div class="card small main-card">
        <div class="card-content">
          <i id="dataset-icon" class="material-icons icon-dataset">{{ dataset.icon }}</i>
          <h1 class="main-card-title">{{ dataset.name|capfirst }}</h1>
          <h2 class="main-card-util">{{ dataset.description }}</h2>
          {% if dataset.long_description != None %}
          <p>{{ dataset.long_description }}</p>
          {% endif %}
          {% if dataset.info != None %}
          <h2 class="main-card-util">Informações úteis</h2>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col s12 m5">
      <div class="card side-card small card-flex">
          <div class="card-content secondary-card-content card-flex-item">
              <h3 class="center secondary-card-title">Tabelas</h3>
              <div style="padding: 0 35px 0;">
                  <ul class="collection">
                    {% for table in dataset.tables|slice:":4" %}
                      <a href="{% url 'core:dataset-table-detail' dataset.slug table.name %}" class="collection-item">
                        {{table.name|capfirst}}
                      </a>
                    {% endfor %}
                  </ul>
              </div>
              {% if dataset.tables|length > 4 %}
              <div class="center"><a href="{% url 'core:dataset-list-detail' dataset.slug 'tabelas' %}">Ver todas</a></div>
              {% endif %}
          </div>
      </div>
    </div>
    <div class="col s12">
      <div class="card medium">
          <div class="card-content" >
              <h2 class="side-card-title">{{dataset.name}}</h2>
              <p>{{ dataset.description }}</p>
              <ul class="metadata">
                <li class="side-card-data">
                  Fonte original: <a class="side-card-data-text" href="{{ dataset.source_url }}" title="Ver fonte original">{{ dataset.source_name }}</a>
                </li>
                <li class="side-card-data">
                  Libertado por: <a class="side-card-data-text" href="{{ dataset.author_url }}" title="Ver liberador">{{ dataset.author_name }}</a>
                </li>
                <li class="side-card-data">
                  Código-fonte: <a class="side-card-data-text" href="{{ dataset.code_url }}" title="Ver código-fonte">{{ dataset.code_url }}</a>
                </li>
                <li class="side-card-data">
                  Licença: <a class="side-card-data-text" href="{{ dataset.license_url }}" title="Ver licença">{{ dataset.license_name }}</a>
                </li>
                <li class="side-card-data">
                  Links relacionados:
                  {% for link in dataset.link_set.all %}
                    <a href="{{ link.url }}" title="Ver mais" target="_blank">{{ link.title }}</a>{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </li>
              </ul>
          </div>
      </div>
    </div>
    <div class="col s12">
      <div class="card">
          <div class="card-content" >
              <h2 class="side-card-title">Referências desta base de dados na mídia</h2>
              <div>
                <table class="highlight">
                  <thead>
                    <tr>
                      <th>Título</th>
                      <th>Autor</th>
                      <th>Categoria</th>
                      <th>Link</th>
                    </tr>
                  </thead>

                  <tbody>
                    {% if clipping|length > 0 %}
                    {% for link in clipping %}
                    <tr onclick="window.open('{{ link.clipping.url }}', '_blank' )" style="cursor: pointer;"
                      title="Clique para acessar o link">
                      <td> {{ link.clipping.title }}</td>
                      <td> {% if link.clipping.author %}{{ link.clipping.author }}{% else %} --- {% endif %} </td>
                      <td> {{ link.clipping.category }} </td>
                      <td class="blue-text text-darken-2"> {{ link.clipping.url|truncatechars:30}}</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr style="cursor: pointer;">
                      <td> --- </td>
                      <td> --- </td>
                      <td> Nenhum link publicado</td>
                      <td> --- </td>
                    </tr>
                    {% endif %}
                  </tbody>

                </table>
                {% if user.is_authenticated %}
                <div style="margin-top: 5px;">
                  <a href="{% url 'core:dataset-form-clipping' %}?next={{ request.path|urlencode }}">Sugerir Referência</a>
                </div>
                {% endif %}
              </div>
          </div>
      </div>
    </div>
  </div>
</div>
{% if messages %}
  {% for message in messages %}
      <script type=text/javascript>M.toast({html: "{{message}}" })</script>
  {% endfor %}
{% endif %}

{% endlocalize %}{% endblock %}

{% block script %}
{{ block.super }}
<script type="text/javascript" language="javascript"
  src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    M.Tabs.init(document.getElementById('tabs'));
    $('select').formSelect();

    $('.mdl-data-table').DataTable({
      "paging": false,
      "searching": false,
      "ordering": false,
      "bInfo": false,
    });
  });
</script>
{% endblock %}